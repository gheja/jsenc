<html>
	<head>
		<title>jsenc02 example - the TKE extension for CryptoJS</title>
		<script type="text/javascript" src="crypto-js/components/core.js"></script>
		<script type="text/javascript" src="crypto-js/components/enc-base64.js"></script>
		<script type="text/javascript" src="crypto-js/components/hmac.js"></script>
		<script type="text/javascript" src="crypto-js/components/md5.js"></script>
		<script type="text/javascript" src="crypto-js/components/evpkdf.js"></script>
		<script type="text/javascript" src="crypto-js/components/cipher-core.js"></script>
		<script type="text/javascript" src="crypto-js/components/pbkdf2.js"></script>
		<script type="text/javascript" src="crypto-js/components/aes.js"></script>
		<script type="text/javascript" src="crypto-js/components/sha256.js"></script>
		<script type="text/javascript" src="crypto-js_hex_formatter.js"></script>
		<script type="text/javascript" src="crypto-js_tke.js"></script>
		<script type="text/javascript" src="jsenc02.js"></script>
		<style type="text/css">
			fieldset
			{
				margin: 0 0 20px 0;
				width: 340px;
			}
			
			div.box
			{
				float: left;
				width: 380px;
			}
			
			label
			{
				display: block;
				margin: 8px 0 0 0;
				padding: 0;
			}
			
			input[type=text],
			select,
			textarea
			{
				width: 100%;
			}
			
			input[readonly=readonly],
			select[readonly=readonly],
			textarea[readonly=readonly]
			{
				background: #cccccc;
			}
			
			textarea
			{
				height: 150px;
			}
			
			.user
			{
				background: #80ffff;
			}
			
			hr.clearer
			{
				float: none;
				clear: both;
			}
		</style>
	</head>
	<body>
		<h1>jsenc02 example - the TKE extension for CryptoJS (WORK IN PROGRESS)</h1>
		
		<h2>About jsenc</h2>
		
		<p>
			<strong>jsenc</strong> is mostly patches and extensions to <a href="http://code.google.com/p/crypto-js/">CryptoJS</a> and also some test scripts to provide demos for their usage. For more info please see the <a href="http://github.com/gheja/jsenc">GitHub repository</a> or the <a href="index.html">index page</a>.
		</p>
		
		<p>
			All the cryptographic work (password hashing, data encryption/decryption) is done <strong>in your browser, no data is ever transmitted to a server</strong>, all the encryption/decryption is happening in this window. This is the exact point of the library. After the page loads you can actually go offline and the page will still work.
		</p>
		
		<h2>About the example</h2>
		
		<p>
			<strong>This example is in a "work in progress" state, most likely it will change and somethimes may simply not work.</strong>
		</p>
		
		<p>
			This example shows the usage of <strong>TKE (two key encryption) scheme extension </strong> for CryptoJS. This scheme is used by disk encryption softwares like <a href="http://en.wikipedia.org/wiki/Linux_Unified_Key_Setup">LUKS</a> and <a href="http://truecrypt.org/">TrueCrypt</a>.
		</p>
		
		<p>
			With the two key encryption scheme you can have your data encrypted with a <strong>"master key" dedicated to data encryption only</strong> (just like in other cases) and instead of supplying the master key everytime, you set (in the most basic situation) an <strong>additional "user key" to encrypt the master key</strong> itself (this is the second key).
		</p>
		
		<p>
			A great advantage lies in using two different keys: you can add another "user key" anytime or delete an existing one <strong>without touching your encrypted data</strong> (as that's encryption is done with the "master key", also you need to know only one "user key" to decrypt the "master key" before). That is, you can have as many independent "user keys" as you want (i.e. users can have their very own keys for a common data) and in fact you don't need to remember the master key, which is generated randomly on the first use.
		</p>
		
		<h2>planned JSON structure</h2>
<pre>
{
	"keys": {
		"0": {
			"encoding": "hex", /* 1 */
			"key_algo": "SHA256", /* 1 */
			"key_salt": "b3661cf591dce8a5f1c451a84a2f2d00",
			"key_iterations": 2344,
			"cipher": "AES", /* 1 */
			"iv": "f591dce8a5f1c451a84a2f2d00b3661c",
			"master_key_data": "dce8a5f1c451a84a2f2d00b3661cf591" /* 2 */
		},
		"1": {
			"encoding": "hex", /* 1 */
			"key_algo": "SHA256", /* 1 */
			"key_salt": "1a84a2f2d00b3661cf591dce8a5f1c45",
			"key_iterations": 5234,
			"cipher": "AES", /* 1 */
			"iv": "8a5f1c451a84a2f2d00b3661cf591dce",
			"master_key_data": "1a84a2f2d00b3661cf591dce8a5f1c45" /* 2 */
		}
	},
	"encoding": "hex", /* 1 */
	"data": "bcc40c60afa8267e9f615b9f5ec9391abcc40c60afa8267e9f615b9f5ec9391abcc40c60afa8267e9f615b9f5ec9391a"
}

1: these parameters cannot be changed at the moment, default values are set above, anything else will be ignored
2: contains the "master key" parameters (cipher, key, iv) encrypted with the "user key"
</pre>
		<h2>All the details</h2>
		
		<div class="box">
			<h3>Container management</h3>
			
			<fieldset>
				<legend>Current container (read-only)</legend>
				
				<label for="container_current_data">Container data (JSON encoded):</label>
				<textarea id="container_current_data" readonly="readonly"></textarea>
				
				<label for="container_current_status">Container status:</label>
				<input type="text" id="container_current_status" value="Container is empty." readonly="readonly" /><br/>
			</fieldset>
			
			<fieldset>
				<legend>Generate a new container</legend>
				
				<input type="button" value="generate" onclick="container_generate();" />
			</fieldset>
			
			<fieldset>
				<legend>Load an existing container</legend>
				
				<label for="container_load_data">Container data (JSON encoded):</label>
				<textarea id="container_load_data"></textarea>
				
				<input type="button" value="load" onclick="container_load();" />
			</fieldset>
			
			<fieldset>
				<legend>Manage current container</legend>
				
				<label for="container_open_password">Open container with password:</label>
				<input type="text" id="container_open_password" value="" class="user" /><br/>
				
				<input type="button" value="open" onclick="container_open();" />
				
				<hr/>
				
				<input type="button" value="close" onclick="container_close();" />
				<input type="button" value="reset" onclick="container_reset();" />
			</fieldset>
		</div>
		
		<div class="box">
			<h3>Master key and key slots</h3>
			
			<fieldset>
				<legend>Master key (read-only)</legend>
				
<!--
				<label for="master_key_password">Master key:</label>
				<input type="text" id="master_key_password" value="" readonly="readonly" /><br/>
				
				<label for="master_key_algo">Hashing algorithm:</label>
				<select id="master_key_algo" readonly="readonly">
					<option value="SHA256">SHA256</option>
				</select><br/>
				
				<label for="master_key_iterations">Hashing iterations:</label>
				<input type="text" id="master_key_iterations" value="" readonly="readonly" /><br/>
				
				<label for="master_key_salt">Hashing salt:</label>
				<input type="text" id="master_key_salt" value="" readonly="readonly" /><br/>
				
-->
				<label for="master_key_cipher">Cipher:</label>
				<select id="master_key_cipher" readonly="readonly">
					<option value="AES">AES</option>
				</select><br/>
				
				<label for="master_key_key">Cipher key:</label>
				<input type="text" id="master_key_key" value="" readonly="readonly" /><br/>
				
				<label for="master_key_iv">Cipher IV (initialization vector):</label>
				<input type="text" id="master_key_iv" value="" readonly="readonly" /><br/>
				
				<label for="master_key_encoding">Output encoding:</label>
				<select id="master_key_encoding" readonly="readonly">
					<option value="hex">hex</option>
				</select><br/>
			</fieldset>
			
			<fieldset>
				<legend>Add key</legend>
				
				<label for="user_key_password">Password:</label>
				<input type="text" id="user_key_password" value="" class="user" /><br/>
				
				<label for="user_key_password2">Password again:</label>
				<input type="text" id="user_key_password2" value="" class="user" /><br/>
				
				<hr/>
				
				<label for="user_key_algo">Password hashing algorithm:</label>
				<select id="user_key_algo" readonly="readonly">
					<option value="SHA256">SHA256</option>
				</select><br/>
				
				<label for="user_key_salt">Password salt:</label>
				<input type="text" id="user_key_salt" value="" /><br/>
				
				<label for="user_key_iterations">Password hashing iterations:</label>
				<input type="text" id="user_key_iterations" value="" /><br/>
				
				<label for="user_key_cipher">Password encryption cipher:</label>
				<select id="user_key_cipher" readonly="readonly">
					<option value="AES">AES</option>
				</select><br/>
				
				<label for="user_key_iv">Cipher IV (initialization vector):</label>
				<input type="text" id="user_key_iv" value="" /><br/>
				
				<label for="user_key_encoding">Output encoding:</label>
				<select id="user_key_encoding" readonly="readonly">
					<option value="hex">hex</option>
				</select><br/>
				
				<input type="button" value="randomize" onclick="user_key_randomize();" />
				<input type="button" value="add" onclick="user_key_add();" /><br/>
			</fieldset>
			
			<fieldset>
				<legend>Remove key</legend>
				
				<label for="user_key_remove_id">Key slot ID:</label>
				<input type="text" id="user_key_remove_id" value="0" /><br/>
				
				<input type="button" value="remove" onclick="user_key_remove();" /><br/>
			</fieldset>
		</div>
		
		<div class="box">
			<h3>Data management</h3>
			
			<fieldset>
				<legend>Current data</legend>
				
				<label for="current_data_data">Current data:</label>
				<textarea id="current_data_data"></textarea>
				
				<input type="button" value="save changes" onclick="current_data_save();" />
				<input type="button" value="discard changes" onclick="current_data_discard();" /><br/>
			</fieldset>
		</div>
		
		<hr class="clearer" />
		
		<a href="http://github.com/gheja/jsenc">http://github.com/gheja/jsenc</a>
	</body>
</html>
